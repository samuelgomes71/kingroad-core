// Sistema de Verificação de Dispositivo Atualizado
// app/src/main/kotlin/com/kingroad/setup

class DeviceCheckManager(
    private val deviceManager: DeviceManager,
    private val gpsManager: GPSManager,
    private val networkManager: NetworkManager,
    private val storageManager: StorageManager
) {
    enum class OperationMode {
        FULL,        // 4GB+ RAM
        OPTIMIZED,   // 3GB RAM
        BASIC,       // 2GB RAM
        INCOMPATIBLE // <2GB RAM
    }

    data class DeviceAssessment(
        val operationMode: OperationMode,
        val availableFeatures: Set<Feature>,
        val restrictions: Set<Restriction>,
        val warnings: List<String>,
        val recommendations: List<String>
    )

    // Analisar RAM e determinar modo de operação
    private fun determineOperationMode(ramGB: Double): OperationMode {
        return when {
            ramGB >= 4.0 -> OperationMode.FULL
            ramGB >= 3.0 -> OperationMode.OPTIMIZED
            ramGB >= 2.0 -> OperationMode.BASIC
            else -> OperationMode.INCOMPATIBLE
        }
    }

    // Avaliar dispositivo e retornar configurações
    suspend fun assessDevice(): DeviceAssessment {
        val ramGB = deviceManager.getTotalRAM().toDouble() / (1024 * 1024 * 1024)
        val mode = determineOperationMode(ramGB)
        
        return when (mode) {
            OperationMode.FULL -> createFullModeAssessment()
            OperationMode.OPTIMIZED -> createOptimizedModeAssessment()
            OperationMode.BASIC -> createBasicModeAssessment()
            OperationMode.INCOMPATIBLE -> createIncompatibleAssessment()
        }
    }

    private fun createFullModeAssessment() = DeviceAssessment(
        operationMode = OperationMode.FULL,
        availableFeatures = setOf(
            Feature.HIGH_QUALITY_GRAPHICS,
            Feature.FULL_BACKGROUND_SERVICES,
            Feature.COMPLETE_MAP_CACHE,
            Feature.ALL_SOCIAL_FEATURES,
            Feature.REAL_TIME_UPDATES,
            Feature.VOICE_COMMANDS,
            Feature.ADVANCED_NAVIGATION
        ),
        restrictions = emptySet(),
        warnings = emptyList(),
        recommendations = listOf(
            "Seu dispositivo suporta todas as funcionalidades do King Road",
            "Recomendado usar Wi-Fi para download de mapas grandes"
        )
    )

    private fun createOptimizedModeAssessment() = DeviceAssessment(
        operationMode = OperationMode.OPTIMIZED,
        availableFeatures = setOf(
            Feature.MEDIUM_QUALITY_GRAPHICS,
            Feature.LIMITED_BACKGROUND_SERVICES,
            Feature.REDUCED_MAP_CACHE,
            Feature.BASIC_SOCIAL_FEATURES,
            Feature.STANDARD_NAVIGATION
        ),
        restrictions = setOf(
            Restriction.REDUCED_GRAPHICS_QUALITY,
            Restriction.LIMITED_BACKGROUND_TASKS,
            Restriction.REDUCED_CACHE_SIZE
        ),
        warnings = listOf(
            "Algumas funcionalidades avançadas estão desativadas para melhor performance"
        ),
        recommendations = listOf(
            "Mantenha apenas mapas essenciais offline",
            "Feche outros aplicativos ao usar navegação"
        )
    )

    private fun createBasicModeAssessment() = DeviceAssessment(
        operationMode = OperationMode.BASIC,
        availableFeatures = setOf(
            Feature.LOW_QUALITY_GRAPHICS,
            Feature.MINIMAL_BACKGROUND_SERVICES,
            Feature.MINIMAL_MAP_CACHE,
            Feature.BASIC_NAVIGATION
        ),
        restrictions = setOf(
            Restriction.LOW_GRAPHICS_QUALITY,
            Restriction.NO_BACKGROUND_TASKS,
            Restriction.MINIMAL_CACHE_SIZE,
            Restriction.NO_SOCIAL_FEATURES,
            Restriction.LIMITED_OFFLINE_MAPS
        ),
        warnings = listOf(
            "Seu dispositivo tem recursos limitados",
            "Apenas funcionalidades básicas de navegação disponíveis",
            "Performance pode ser afetada em rotas longas"
        ),
        recommendations = listOf(
            "Mantenha apenas um mapa offline por vez",
            "Feche todos os outros aplicativos ao usar navegação",
            "Evite rotas muito longas ou complexas",
            "Considere atualizar seu dispositivo para melhor experiência"
        )
    )

    private fun createIncompatibleAssessment() = DeviceAssessment(
        operationMode = OperationMode.INCOMPATIBLE,
        availableFeatures = emptySet(),
        restrictions = setOf(Restriction.INCOMPATIBLE_DEVICE),
        warnings = listOf(
            "Seu dispositivo não atende aos requisitos mínimos",
            "King Road requer no mínimo 2GB de RAM",
            "Instalação não recomendada"
        ),
        recommendations = listOf(
            "Use um dispositivo com no mínimo 2GB de RAM",
            "Recomendado: 4GB ou mais para melhor experiência"
        )
    )

    enum class Feature {
        HIGH_QUALITY_GRAPHICS,
        MEDIUM_QUALITY_GRAPHICS,
        LOW_QUALITY_GRAPHICS,
        FULL_BACKGROUND_SERVICES,
        LIMITED_BACKGROUND_SERVICES,
        MINIMAL_BACKGROUND_SERVICES,
        COMPLETE_MAP_CACHE,
        REDUCED_MAP_CACHE,
        MINIMAL_MAP_CACHE,
        ALL_SOCIAL_FEATURES,
        BASIC_SOCIAL_FEATURES,
        REAL_TIME_UPDATES,
        VOICE_COMMANDS,
        ADVANCED_NAVIGATION,
        STANDARD_NAVIGATION,
        BASIC_NAVIGATION
    }

    enum class Restriction {
        REDUCED_GRAPHICS_QUALITY,
        LOW_GRAPHICS_QUALITY,
        LIMITED_BACKGROUND_TASKS,
        NO_BACKGROUND_TASKS,
        REDUCED_CACHE_SIZE,
        MINIMAL_CACHE_SIZE,
        NO_SOCIAL_FEATURES,
        LIMITED_OFFLINE_MAPS,
        INCOMPATIBLE_DEVICE
    }
}