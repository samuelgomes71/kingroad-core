// Sistema de Verificação de Dispositivo Atualizado
// app/src/main/kotlin/com/kingroad/setup

class DeviceCheckManager(
    private val deviceManager: DeviceManager,
    private val gpsManager: GPSManager,
    private val networkManager: NetworkManager,
    private val storageManager: StorageManager
) {
    enum class OperationMode {
        FULL,        // 4GB+ RAM
        OPTIMIZED,   // 3GB RAM
        INCOMPATIBLE // <3GB RAM
    }

    data class DeviceAssessment(
        val operationMode: OperationMode,
        val availableFeatures: Set<Feature>,
        val restrictions: Set<Restriction>,
        val warnings: List<String>,
        val recommendations: List<String>
    )

    // Analisar RAM e determinar modo de operação
    private fun determineOperationMode(ramGB: Double): OperationMode {
        return when {
            ramGB >= 4.0 -> OperationMode.FULL
            ramGB >= 3.0 -> OperationMode.OPTIMIZED
            else -> OperationMode.INCOMPATIBLE
        }
    }

    private fun createFullModeAssessment() = DeviceAssessment(
        operationMode = OperationMode.FULL,
        availableFeatures = setOf(
            Feature.HIGH_QUALITY_GRAPHICS,
            Feature.FULL_BACKGROUND_SERVICES,
            Feature.COMPLETE_MAP_CACHE,
            Feature.ALL_SOCIAL_FEATURES,
            Feature.REAL_TIME_UPDATES,
            Feature.VOICE_COMMANDS,
            Feature.ADVANCED_NAVIGATION
        ),
        restrictions = emptySet(),
        warnings = emptyList(),
        recommendations = listOf(
            "Seu dispositivo suporta todas as funcionalidades do King Road",
            "Recomendado usar Wi-Fi para download de mapas grandes"
        )
    )

    private fun createOptimizedModeAssessment() = DeviceAssessment(
        operationMode = OperationMode.OPTIMIZED,
        availableFeatures = setOf(
            Feature.MEDIUM_QUALITY_GRAPHICS,
            Feature.LIMITED_BACKGROUND_SERVICES,
            Feature.REDUCED_MAP_CACHE,
            Feature.BASIC_SOCIAL_FEATURES,
            Feature.STANDARD_NAVIGATION
        ),
        restrictions = setOf(
            Restriction.REDUCED_GRAPHICS_QUALITY,
            Restriction.LIMITED_BACKGROUND_TASKS,
            Restriction.REDUCED_CACHE_SIZE
        ),
        warnings = listOf(
            "Algumas funcionalidades podem ter performance reduzida"
        ),
        recommendations = listOf(
            "Mantenha apenas mapas essenciais offline",
            "Feche outros aplicativos ao usar navegação"
        )
    )

    private fun createIncompatibleAssessment() = DeviceAssessment(
        operationMode = OperationMode.INCOMPATIBLE,
        availableFeatures = emptySet(),
        restrictions = setOf(Restriction.INCOMPATIBLE_DEVICE),
        warnings = listOf(
            "Dispositivo incompatível com o King Road",
            "É necessário no mínimo 3GB de RAM",
            "Instalação não permitida"
        ),
        recommendations = listOf(
            "Utilize um dispositivo com 3GB de RAM ou superior",
            "Recomendado: 4GB ou mais para melhor experiência",
            "O King Road é um aplicativo profissional que requer hardware adequado"
        )
    )

    // Avaliar dispositivo e retornar configurações
    suspend fun assessDevice(): DeviceAssessment {
        val ramGB = deviceManager.getTotalRAM().toDouble() / (1024 * 1024 * 1024)
        val mode = determineOperationMode(ramGB)
        
        return when (mode) {
            OperationMode.FULL -> createFullModeAssessment()
            OperationMode.OPTIMIZED -> createOptimizedModeAssessment()
            OperationMode.INCOMPATIBLE -> createIncompatibleAssessment()
        }
    }
}